generator client {
  provider = "prisma-client-rust"
  output   = "../src/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  email     String   @unique
  password  String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  packages Package[]
  
  @@map("users")
}

model Package {
  id          String     @id @default(cuid())
  name        String
  version     String
  description String?
  maintainer  String
  architecture String
  size        Int
  checksum    String
  filePath    String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  dependencies PackageDependency[]
  tags         PackageTag[]

  @@unique([name, version])
  @@map("packages")
}

model PackageDependency {
  id         String @id @default(cuid())
  packageId  String
  depName    String
  depVersion String
  type       DependencyType @default(REQUIRES)

  package Package @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@map("package_dependencies")
}

model Tag {
  id    String @id @default(cuid())
  name  String @unique
  color String @default("#007bff")

  packages PackageTag[]

  @@map("tags")
}

model PackageTag {
  id        String @id @default(cuid())
  packageId String
  tagId     String

  package Package @relation(fields: [packageId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([packageId, tagId])
  @@map("package_tags")
}

enum UserRole {
  ADMIN
  USER
}

enum DependencyType {
  REQUIRES
  RECOMMENDS
  SUGGESTS
  CONFLICTS
}